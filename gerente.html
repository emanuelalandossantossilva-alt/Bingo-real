<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel de Administra√ß√£o - Bingo</title>
    <style>
        body { font-family: sans-serif; background: #020617; color: white; padding: 20px; text-align: center; }
        .box-login { background: #1e293b; padding: 30px; border-radius: 15px; display: inline-block; border: 1px solid #facc15; }
        .card { background: #1e293b; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #334155; display: flex; justify-content: space-between; align-items: center; text-align: left;}
        input { padding: 10px; border-radius: 5px; border: 1px solid #334155; background: #0f172a; color: white; margin: 10px 0; }
        button { padding: 10px 20px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; background: #22c55e; color: white; }
        #conteudoGerente { display: none; }
    </style>
</head>
<body>

    <div id="telaLogin">
        <div class="box-login">
            <h2 style="color:#facc15;">Acesso Restrito</h2>
            <input type="password" id="senhaInput" placeholder="Senha Mestra">
            <br>
            <button onclick="verificarSenha()">ENTRAR</button>
        </div>
    </div>

    <div id="conteudoGerente">
        <h1 style="color:#facc15;">Gerenciador de Cr√©ditos</h1>
        <button style="background:#3b82f6; width: 100%; margin-bottom: 20px;" onclick="carregarJogadores()">üîÑ ATUALIZAR LISTA</button>
        <div id="lista">Carregando jogadores...</div>
    </div>

    <script>
        // Use exatamente este link que funcionou no seu Cron-job
        const API = "https://bingo-backend-89dt.onrender.com"; 
        const SENHA_MESTRA = "1234";

        function verificarSenha() {
            if (document.getElementById('senhaInput').value === SENHA_MESTRA) {
                document.getElementById('telaLogin').style.display = 'none';
                document.getElementById('conteudoGerente').style.display = 'block';
                carregarJogadores();
            } else { alert("Senha Incorreta!"); }
        }

        async function carregarJogadores() {
            try {
                const res = await fetch(`${API}/users`);
                if (!res.ok) throw new Error();
                const dados = await res.json();
                const lista = document.getElementById('lista');
                lista.innerHTML = "";
                dados.forEach(u => {
                    lista.innerHTML += `
                        <div class="card">
                            <div><b>${u.name.toUpperCase()}</b><br><span>R$ ${u.saldo.toFixed(2)}</span></div>
                            <div>
                                <input type="number" id="val-${u._id}" style="width:60px" placeholder="R$">
                                <button onclick="addSaldo('${u._id}')">ADD</button>
                            </div>
                        </div>`;
                });
            } catch (e) { 
                alert("O servidor ainda est√° ligando. Aguarde 30 segundos e tente o bot√£o azul novamente."); 
            }
        }

        async function addSaldo(id) {
            const valor = document.getElementById(`val-${id}`).value;
            if(!valor) return;
            try {
                const res = await fetch(`${API}/add-saldo`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ userId: id, amount: parseFloat(valor) })
                });
                if(res.ok) { alert("Saldo atualizado!"); carregarJogadores(); }
            } catch (err) { alert("Erro ao salvar saldo."); }
        }
    </script>
</body>
</html>

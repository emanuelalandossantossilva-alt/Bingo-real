<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Real - Oficial</title>
    <style>
        :root { --primary: #facc15; --bg: #020617; --card: #1e293b; --success: #22c55e; }
        body { font-family: sans-serif; background: var(--bg); color: white; text-align: center; margin: 0; padding: 10px; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid var(--primary); margin: 10px auto; max-width: 380px; }
        .hidden { display: none !important; }
        .caixa-premio { background: #064e3b; border: 2px solid var(--success); padding: 15px; border-radius: 10px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; }
        .acumulando { color: var(--primary); animation: piscar 1.2s infinite; font-weight: bold; font-size: 20px; text-transform: uppercase; }
        @keyframes piscar { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .container-cartelas { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 15px; }
        .cartela { background: #f8fafc; color: #1e293b; padding: 10px; border-radius: 8px; border: 2px solid var(--primary); width: 150px; }
        .nome-dono { font-size: 10px; font-weight: bold; color: #1e293b; border-bottom: 1px solid #ddd; margin-bottom: 5px; padding-bottom: 2px; }
        .grid-cartela { display: grid; grid-template-columns: repeat(5, 1fr); gap: 3px; }
        .numero { font-size: 10px; font-weight: bold; background: #e2e8f0; padding: 4px 0; border-radius: 4px; }
        .marcado { background: var(--success) !important; color: white; }
        input { width: 100%; padding: 12px; margin: 5px 0; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 14px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin: 5px 0; text-transform: uppercase; }
        .bola-sorteada { width: 25px; height: 25px; background: var(--primary); color: black; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 20px; border-radius: 15px; color: black; width: 80%; max-width: 300px; }
        /* Estilo para o campo de cÃ³pia invisÃ­vel */
        #pixInvisivel { position: absolute; left: -9999px; }
    </style>
</head>
<body>

<div id="modalPix" class="modal hidden">
    <div class="modal-content">
        <h3>PAGAMENTO PIX</h3>
        <img id="qrImagem" style="width:100%" src="">
        <div id="qrTexto" style="font-size:10px; word-break:break-all; margin:10px 0; background:#eee; padding:8px; border: 1px dashed #ccc;"></div>
        <input type="text" id="pixInvisivel">
        
        <button onclick="copiarPix()" style="background:#2563eb; color:white;">COPIAR CÃ“DIGO PIX</button>
        <button onclick="document.getElementById('modalPix').classList.add('hidden')" style="background:#ef4444; color:white;">FECHAR</button>
    </div>
</div>

<div id="telaAuth" class="card">
    <h2 style="color:var(--primary)">BINGO REAL</h2>
    <div style="background: #0f172a; padding: 15px; border-radius: 8px;">
        <div id="campoNome" class="hidden"><input type="text" id="regNome" placeholder="Seu Nome Completo"></div>
        <input type="email" id="loginEmail" placeholder="E-mail">
        <input type="password" id="loginSenha" placeholder="Senha">
        <div id="btnsLogin">
            <button style="background: #2563eb; color: white;" onclick="fazerLogin()">ENTRAR</button>
            <button style="background: transparent; color: #94a3b8; font-size: 11px;" onclick="mostrarCadastro()">NÃ£o tem conta? Cadastre-se</button>
        </div>
        <div id="btnsCadastro" class="hidden">
            <button style="background: var(--success); color: white;" onclick="fazerCadastro()">FINALIZAR CADASTRO</button>
            <button style="background: transparent; color: #94a3b8; font-size: 11px;" onclick="mostrarLogin()">JÃ¡ tenho conta</button>
        </div>
    </div>
</div>

<div id="telaJogo" class="hidden">
    <div class="card">
        <div class="caixa-premio"><div class="acumulando">ACUMULANDO...</div></div>
        <div id="timerTxt" style="font-size:24px; color:var(--primary); font-weight:bold;">00:00</div>
        <div id="bolaGrande" style="font-size:55px; margin:5px 0;">--</div>
        <div id="historicoBolas" style="display:flex; flex-wrap:wrap; justify-content:center; gap:5px; margin-bottom: 10px;"></div>
        <div style="margin:10px 0;"><span id="playerSaldo" style="color:var(--success); font-weight:bold; font-size:22px;">Saldo: R$ 0,00</span></div>
        <button style="background: #16a34a; color: white;" onclick="gerarPix()">DEPOSITAR</button>
        <button style="background: #2563eb; color: white;" onclick="comprarCartelas()">COMPRAR CARTELA (R$ 2,00)</button>
        <div id="listaCartelas" class="container-cartelas"></div>
        <button style="background: transparent; color: #94a3b8; font-size: 10px; margin-top: 20px;" onclick="logout()">SAIR DA CONTA</button>
    </div>
</div>

<script>
    const API = "https://bingo-backend-89dt.onrender.com";
    let USER_ID = localStorage.getItem('userId');

    function mostrarCadastro() {
        document.getElementById('campoNome').classList.remove('hidden');
        document.getElementById('btnsCadastro').classList.remove('hidden');
        document.getElementById('btnsLogin').classList.add('hidden');
    }

    function mostrarLogin() {
        document.getElementById('campoNome').classList.add('hidden');
        document.getElementById('btnsCadastro').classList.add('hidden');
        document.getElementById('btnsLogin').classList.remove('hidden');
    }

    async function fazerLogin() {
        const email = document.getElementById('loginEmail').value;
        const senha = document.getElementById('loginSenha').value;
        const res = await fetch(`${API}/login`, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ email, senha })
        });
        if(res.ok) {
            const d = await res.json();
            localStorage.setItem('userId', d.user._id);
            location.reload();
        } else alert("E-mail ou senha incorretos!");
    }

    async function fazerCadastro() {
        const name = document.getElementById('regNome').value;
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginSenha').value;
        if(!name || !email || !password) return alert("Preencha todos os campos!");
        const res = await fetch(`${API}/register`, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ name, email, password })
        });
        if(res.ok) alert("Cadastro feito! Agora faÃ§a login.");
        else alert("Erro ao cadastrar.");
        mostrarLogin();
    }

    function logout() { localStorage.removeItem('userId'); location.reload(); }

    async function atualizarInterface() {
        if(!USER_ID) return;
        try {
            const resUser = await fetch(`${API}/user-data/${USER_ID}?t=${Date.now()}`);
            const user = await resUser.json();
            document.getElementById('playerSaldo').innerText = `Saldo: R$ ${user.saldo.toFixed(2)}`;
            const resStatus = await fetch(`${API}/game-status?t=${Date.now()}`);
            const jogo = await resStatus.json();
            document.getElementById('timerTxt').innerText = jogo.tempoRestante;
            document.getElementById('bolaGrande').innerText = jogo.bolas.length > 0 ? jogo.bolas[jogo.bolas.length - 1] : "--";
            document.getElementById('historicoBolas').innerHTML = jogo.bolas.map(b => `<div class="bola-sorteada">${b}</div>`).join('');

            if(user.cartelas) {
                document.getElementById('listaCartelas').innerHTML = user.cartelas.map((c, idx) => {
                    return `<div class="cartela">
                        <div class="nome-dono">ðŸ‘¤ ${user.name}</div>
                        <div class="grid-cartela">${c.map(num => `<div class="numero ${jogo.bolas.includes(num) ? 'marcado' : ''}">${num}</div>`).join('')}</div>
                    </div>`;
                }).join('');
            }
        } catch(e) {}
    }

    async function gerarPix() {
        const valor = prompt("Valor (MÃ­nimo 10):", "10");
        if(!valor || valor < 10) return;
        const res = await fetch(`${API}/gerar-pix`, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ userId: USER_ID, valor })
        });
        const data = await res.json();
        if(data.qr_code_base64) {
            document.getElementById('qrImagem').src = `data:image/png;base64,${data.qr_code_base64}`;
            document.getElementById('qrTexto').innerText = data.qr_code;
            document.getElementById('pixInvisivel').value = data.qr_code; // Guarda no campo invisÃ­vel
            document.getElementById('modalPix').classList.remove('hidden');
        }
    }

    // NOVA FUNÃ‡ÃƒO DE COPIAR MAIS FORTE
    function copiarPix() { 
        const inputInvisivel = document.getElementById('pixInvisivel');
        inputInvisivel.select();
        inputInvisivel.setSelectionRange(0, 99999); // Para celulares
        
        try {
            document.execCommand('copy');
            alert("âœ… CÃ“DIGO PIX COPIADO! Agora cole no seu banco.");
        } catch (err) {
            // Caso o comando falhe, tenta o mÃ©todo moderno
            navigator.clipboard.writeText(inputInvisivel.value);
            alert("âœ… CÃ“DIGO PIX COPIADO!");
        }
    }

    if(USER_ID) {
        document.getElementById('telaAuth').classList.add('hidden');
        document.getElementById('telaJogo').classList.remove('hidden');
        setInterval(atualizarInterface, 1000); 
        atualizarInterface();
    }
</script>
</body>
</html>


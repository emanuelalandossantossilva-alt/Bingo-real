<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Real - Multi-Cartelas</title>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #1a1a1a; color: white; text-align: center; margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: #2a2a2a; padding: 20px; border-radius: 15px; border: 2px solid #edb120; }
        
        .acumulado-container { background: linear-gradient(145deg, #edb120, #b8860b); color: #000; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-weight: bold; font-size: 22px; }
        .saldo-box { font-size: 24px; color: #28a745; font-weight: bold; margin-bottom: 10px; background: #000; padding: 10px; border-radius: 8px; border: 1px solid #28a745; }
        .timer-display { font-size: 40px; font-weight: bold; color: #fff; margin: 10px 0; }

        /* Estilo da Compra */
        .compra-area { background: #333; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        .input-qtd { width: 60px; padding: 10px; font-size: 18px; text-align: center; border-radius: 5px; border: none; margin-bottom: 10px; }
        .btn-comprar { background: #edb120; color: #000; border: none; padding: 15px; border-radius: 8px; width: 100%; font-weight: bold; font-size: 18px; cursor: pointer; }
        
        /* Listagem de Cartelas */
        .cartelas-container { max-height: 300px; overflow-y: auto; margin-top: 20px; padding: 10px; }
        .cartela-item { background: #fff; color: #000; padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #edb120; }
        .grid-nums { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 5px; }
        .n-box { background: #eee; border: 1px solid #ccc; padding: 5px; font-weight: bold; font-size: 14px; border-radius: 3px; }

        .financeiro { margin-top: 20px; padding-top: 20px; border-top: 1px solid #444; }
        input[type="number"], input[type="text"] { width: 85%; padding: 12px; margin: 5px 0; border-radius: 5px; border: none; text-align: center; }
        .btn-pix { background: #28a745; color: white; border: none; padding: 12px; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
    </style>
</head>
<body onload="iniciar()">

    <div class="container">
        <div id="tela-principal">
            <div class="acumulado-container">ACUMULANDO...</div>
            <div class="saldo-box">SALDO: R$ <span id="txt-saldo">0,00</span></div>
            
            <div class="timer-display" id="relogio">05:00</div>

            <div class="compra-area">
                <p style="margin: 0 0 10px 0;">Quantas cartelas deseja?</p>
                <input type="number" id="qtd-cartelas" class="input-qtd" value="1" min="1" max="50">
                <button class="btn-comprar" onclick="comprarVárias()">COMPRAR AGORA (R$ 2,00 cada)</button>
            </div>

            <div id="lista-de-cartelas" class="cartelas-container">
                </div>

            <div class="financeiro">
                <input type="number" id="deposito-val" value="10" min="10">
                <button class="btn-pix" onclick="depositar()">DEPOSITAR VIA PIX</button>
            </div>
        </div>
    </div>

    <script>
        let saldoReal = 0.00;
        let tempo = 300;
        const API = "https://bingo-backend-89dt.onrender.com";

        function iniciar() {
            atualizarTelaSaldo();
            setInterval(() => {
                if(tempo > 0) {
                    tempo--;
                    let m = Math.floor(tempo/60);
                    let s = tempo%60;
                    document.getElementById('relogio').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                }
            }, 1000);
        }

        function comprarVárias() {
            const qtd = parseInt(document.getElementById('qtd-cartelas').value);
            const custoTotal = qtd * 2.00;

            if (isNaN(qtd) || qtd <= 0) return alert("Digite uma quantidade válida!");
            
            if (saldoReal >= custoTotal) {
                saldoReal -= custoTotal;
                atualizarTelaSaldo();
                
                const container = document.getElementById('lista-de-cartelas');
                // container.innerHTML = ""; // Limpar as antigas se quiser, ou acumular

                for(let i = 0; i < qtd; i++) {
                    const nums = gerarNumerosBingo();
                    adicionarCartelaNaTela(nums);
                }
                
                alert(`Sucesso! Você comprou ${qtd} cartela(s).`);
            } else {
                alert(`Saldo insuficiente! Você precisa de R$ ${custoTotal.toFixed(2)} para comprar ${qtd} cartelas.`);
            }
        }

        function gerarNumerosBingo() {
            let n = [];
            while(n.length < 10) {
                let num = Math.floor(Math.random() * 50) + 1;
                if(!n.includes(num) && ![11,22,33,44].includes(num)) {
                    // Travas de sequência
                    if(!(n.includes(num-1) && n.includes(num-2))) n.push(num);
                }
            }
            return n.sort((a,b) => a - b);
        }

        function adicionarCartelaNaTela(nums) {
            const container = document.getElementById('lista-de-cartelas');
            const id = Math.floor(Math.random() * 99999);
            
            let gridHtml = "";
            nums.forEach(n => gridHtml += `<div class="n-box">${n < 10 ? '0'+n : n}</div>`);

            const cartelaHtml = `
                <div class="cartela-item">
                    <strong>CARTELA #GT-${id}</strong>
                    <div class="grid-nums">${gridHtml}</div>
                </div>
            `;
            container.innerHTML = cartelaHtml + container.innerHTML; // Adiciona no topo
        }

        function atualizarTelaSaldo() {
            document.getElementById('txt-saldo').innerText = saldoReal.toFixed(2).replace('.', ',');
        }

        async function depositar() {
            // Função real conectada ao seu Render
            const val = document.getElementById('deposito-val').value;
            try {
                const res = await fetch(`${API}/gerar-pix`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ valor: val })
                });
                const data = await res.json();
                if(data.qr_code) {
                    prompt("Copie seu PIX:", data.qr_code);
                    // Aqui você esperaria o Webhook do MP confirmar
                }
            } catch(e) { alert("Conectando ao servidor..."); }
        }
    </script>
</body>
</html>

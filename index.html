<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Real - Oficial</title>
    <style>
        :root { 
            --primary: #facc15; 
            --primary-dark: #ca8a04;
            --bg: #020617; 
            --card: rgba(30, 41, 59, 0.7); 
            --success: #22c55e; 
            --glass: rgba(255, 255, 255, 0.05);
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        html, body { 
            height: 100%; 
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at top, #1e293b 0%, #020617 100%);
            color: white;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        .hidden { display: none !important; }

        /* --- DESIGN PROFISSIONAL DO LOGIN --- */
        .auth-container { 
            height: 100vh; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            padding: 20px;
            background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
        }

        .logo-container { margin-bottom: 30px; text-align: center; }
        .logo-main {
            font-size: 42px;
            font-weight: 900;
            color: var(--primary);
            text-shadow: 0 0 20px rgba(250, 204, 21, 0.4);
            letter-spacing: -1px;
            margin: 0;
        }
        .logo-sub { font-size: 12px; text-transform: uppercase; letter-spacing: 4px; color: #94a3b8; margin-top: -5px; }

        .auth-card { 
            background: var(--card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 30px; 
            border-radius: 24px; 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            width: 100%; 
            max-width: 360px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; font-size: 11px; color: #94a3b8; margin-bottom: 5px; margin-left: 5px; }

        input { 
            width: 100%; 
            padding: 14px 18px; 
            border-radius: 12px; 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            background: rgba(0, 0, 0, 0.2); 
            color: white; 
            font-size: 16px;
            transition: all 0.3s;
        }
        input:focus { outline: none; border-color: var(--primary); background: rgba(0, 0, 0, 0.4); }

        .btn-primary { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: #451a03;
            width: 100%; 
            padding: 16px; 
            border: none; 
            border-radius: 12px; 
            font-weight: 800; 
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 10px 15px -3px rgba(250, 204, 21, 0.3);
            transition: transform 0.2s;
        }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; transform: scale(1) !important; }
        .btn-primary:active { transform: scale(0.98); }

        .btn-secondary { background: transparent; color: #94a3b8; width: 100%; border: none; font-size: 14px; margin-top: 15px; cursor: pointer; }

        /* --- ESTILOS DO JOGO --- */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 0 15px; background: #0f172a; border-bottom: 2px solid var(--primary); height: 60px; }
        .status-bar-topo { display: grid; grid-template-columns: 1fr 1fr 1fr; background: #1e293b; padding: 10px 5px; border-bottom: 1px solid #334155; }
        .status-item { display: flex; flex-direction: column; align-items: center; border-right: 1px solid #334155; }
        .status-item:last-child { border-right: none; }
        .status-label { font-size: 9px; color: #94a3b8; text-transform: uppercase; }
        .status-val { font-size: 14px; font-weight: bold; }
        
        .card { background: #1e293b; padding: 15px; border-radius: 15px; border: 1px solid var(--primary); margin: 10px; }
        .bola-sorteada-master { width: 80px; height: 80px; background: radial-gradient(circle at 30% 30%, #fff, #facc15 60%, #b45309); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; font-weight: 900; color: #000; box-shadow: 0 10px 20px rgba(0,0,0,0.5); margin: 0 auto 15px; }
        
        .painel-numeros { display: grid; grid-template-columns: repeat(10, 1fr); gap: 3px; background: #020617; padding: 5px; border-radius: 8px; }
        .num-check { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 10px; background: #1e293b; color: #475569; border-radius: 4px; }
        .num-check.ativo { background: var(--success); color: white; box-shadow: 0 0 10px var(--success); }
        
        #listaCartelas { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 20px 10px; height: calc(100vh - 400px); overflow-y: auto; }
        .cartela { background: white; color: #1e293b; padding: 8px; border-radius: 8px; width: 115px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .grid-cartela { display: grid; grid-template-columns: repeat(5, 1fr); gap: 2px; }
        .num-c { font-size: 11px; font-weight: bold; background: #f1f5f9; padding: 5px 0; border-radius: 2px; text-align: center; }
        .marcado { background: var(--success) !important; color: white !important; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; z-index: 5000; }
        .modal-content { background: white; padding: 25px; border-radius: 24px; color: #020617; width: 85%; max-width: 320px; }
    </style>
</head>
<body>

<audio id="audioBola" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>

<div id="telaAuth" class="auth-container">
    <div class="logo-container">
        <h1 class="logo-main">BINGO REAL</h1>
        <div class="logo-sub">Premiando a sua sorte</div>
    </div>

    <div class="auth-card">
        <div class="input-group">
            <label>E-MAIL DE ACESSO</label>
            <input type="email" id="emailLogin" placeholder="seu@email.com">
        </div>
        <div class="input-group">
            <label>SENHA SECRETA</label>
            <input type="password" id="senhaLogin" placeholder="••••••••">
        </div>
        <button id="btnLogin" class="btn-primary" onclick="fazerLogin()">Entrar na Conta</button>
        <button class="btn-secondary" onclick="document.getElementById('modalReg').classList.remove('hidden')">Não tem conta? <b>Cadastre-se</b></button>
    </div>
</div>

<div id="modalReg" class="modal hidden">
    <div class="auth-card" style="background: #1e293b; border: 1px solid var(--success);">
        <h2 style="margin-top:0; text-align:center; color: var(--success);">CRIAR CONTA</h2>
        <input type="text" id="regNome" placeholder="Seu Nome Completo" style="margin-bottom:10px">
        <input type="email" id="regEmail" placeholder="Seu Melhor E-mail" style="margin-bottom:10px">
        <input type="password" id="regSenha" placeholder="Crie uma Senha" style="margin-bottom:15px">
        <button class="btn-primary" style="background: var(--success); color: white;" onclick="fazerCadastro()">Concluir Cadastro</button>
        <button class="btn-secondary" onclick="document.getElementById('modalReg').classList.add('hidden')">Voltar para Login</button>
    </div>
</div>

<div id="telaJogo" class="hidden">
    <div class="header">
        <div style="font-weight:900; color:var(--primary); font-size:18px;">BINGO REAL</div>
        <div style="display:flex; gap:10px;">
            <button onclick="abrirModalValor()" style="background:var(--success); color:white; border:none; padding:8px 15px; border-radius:8px; font-weight:bold; cursor:pointer;">PIX</button>
            <button onclick="logout()" style="background:#ef4444; border:none; border-radius:8px; padding:8px; cursor:pointer;"><img src="https://cdn-icons-png.flaticon.com/512/126/126467.png" width="15" style="filter:invert(1)"></button>
        </div>
    </div>

    <div class="status-bar-topo">
        <div class="status-item"><span class="status-label">Tempo</span><span id="timerTxt" class="status-val" style="color:var(--primary);">00:00</span></div>
        <div class="status-item"><span class="status-label">Saldo</span><span id="playerSaldoStatus" class="status-val" style="color:var(--success);">R$ 0,00</span></div>
        <div class="status-item"><span class="status-label">ID</span><span id="userIdDisplay" class="status-val" style="font-size:10px;">...</span></div>
    </div>

    <div class="card">
        <div id="bolaGrande" class="bola-sorteada-master">--</div>
        <div class="painel-numeros" id="gradeNumeros"></div>
    </div>

    <div style="padding: 0 15px;">
        <button onclick="comprarCartelas()" style="background:#2563eb; color:white; width:100%; padding:15px; border-radius:12px; border:none; font-weight:bold; font-size:16px;">COMPRAR CARTELA (R$ 1,00)</button>
    </div>

    <div id="listaCartelas"></div>
</div>

<div id="modalValor" class="modal hidden">
    <div class="modal-content">
        <h3 style="margin:0 0 20px 0; text-align:center;">DEPOSITAR SALDO</h3>
        <input type="number" id="valorInputManual" placeholder="Valor Mínimo R$ 10" style="color:black; background:#f1f5f9; border: 1px solid #cbd5e1; margin-bottom:10px">
        <button onclick="confirmarGerarPix()" style="background: var(--success); color: white; width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold;">GERAR QR CODE PIX</button>
        <button onclick="document.getElementById('modalValor').classList.add('hidden')" style="width:100%; background:none; border:none; color:#64748b; margin-top:10px;">Cancelar</button>
    </div>
</div>

<div id="modalPix" class="modal hidden">
    <div class="modal-content" style="text-align:center;">
        <h3>PAGUE O PIX</h3>
        <img id="qrImagem" style="width:200px; margin:20px auto; display:block;" src="">
        <button class="btn-primary" onclick="navigator.clipboard.writeText(document.getElementById('pixCopiaCola').value); alert('Copiado!')">COPIAR CÓDIGO</button>
        <button onclick="location.reload()" style="margin-top:15px; border:none; background:none; color:#ef4444; font-weight:bold; cursor:pointer;">JÁ PAGUEI / FECHAR</button>
        <input type="hidden" id="pixCopiaCola">
    </div>
</div>

<script>
    const API = "https://bingo-backend-89dt.onrender.com";
    let USER_ID = localStorage.getItem('userId');
    let ultimaBolaSorteada = null;
    let segundosRestantes = 0;

    function tocarSomBola() {
        const som = document.getElementById('audioBola');
        som.currentTime = 0;
        som.play().catch(e => console.log("Som aguardando interação"));
    }

    async function fazerLogin() {
        const email = document.getElementById('emailLogin').value;
        const senha = document.getElementById('senhaLogin').value;
        const btn = document.getElementById('btnLogin');
        
        if(!email || !senha) return alert("Preencha os campos!");
        
        btn.innerText = "Conectando...";
        btn.disabled = true;

        try {
            const res = await fetch(`${API}/login`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ email, senha })
            });
            const data = await res.json();
            if(res.ok) {
                localStorage.setItem('userId', data._id);
                location.reload();
            } else {
                alert("E-mail ou senha incorretos.");
                btn.innerText = "Entrar na Conta";
                btn.disabled = false;
            }
        } catch(e) {
            alert("O servidor está acordando... Tente novamente em 15 segundos.");
            btn.innerText = "Entrar na Conta";
            btn.disabled = false;
        }
    }

    async function fazerCadastro() {
        const name = document.getElementById('regNome').value;
        const email = document.getElementById('regEmail').value;
        const senha = document.getElementById('regSenha').value;
        try {
            const res = await fetch(`${API}/register`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name, email, senha })
            });
            if(res.ok) { alert("Cadastrado! Faça login agora."); location.reload(); }
            else { alert("E-mail já existe."); }
        } catch(e) { alert("Erro ao cadastrar."); }
    }

    function iniciarGrade() {
        const grade = document.getElementById('gradeNumeros');
        grade.innerHTML = '';
        for (let i = 1; i <= 50; i++) grade.innerHTML += `<div class="num-check" id="num-${i}">${i}</div>`;
    }

    async function atualizarInterface() {
        if(!USER_ID) return;
        try {
            const resS = await fetch(`${API}/game-status`);
            const jogo = await resS.json();
            const resU = await fetch(`${API}/user-data/${USER_ID}`);
            const user = await resU.json();

            document.getElementById('playerSaldoStatus').innerText = `R$ ${user.saldo.toFixed(2)}`;
            document.getElementById('userIdDisplay').innerText = USER_ID.substring(0,6);
            segundosRestantes = jogo.tempoSegundos || 0;

            const bolas = jogo.bolas || [];
            if (bolas.length > 0) {
                const nova = bolas[bolas.length - 1];
                if(nova !== ultimaBolaSorteada) {
                    document.getElementById('bolaGrande').innerText = nova;
                    tocarSomBola();
                    ultimaBolaSorteada = nova;
                }
            }

            document.querySelectorAll('.num-check').forEach(el => el.classList.remove('ativo'));
            bolas.forEach(b => document.getElementById(`num-${b}`)?.classList.add('ativo'));

            document.getElementById('listaCartelas').innerHTML = (user.cartelas || []).map(c => `
                <div class="cartela">
                    <div class="grid-cartela">${c.map(n => `<div class="num-c ${bolas.includes(n)?'marcado':''}">${n}</div>`).join('')}</div>
                </div>
            `).join('');
        } catch(e) {}
    }

    async function confirmarGerarPix() {
        const val = document.getElementById('valorInputManual').value;
        const res = await fetch(`${API}/gerar-pix`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ userId: USER_ID, valor: parseFloat(val) }) });
        const data = await res.json();
        if (data.qr_code_base64) {
            document.getElementById('qrImagem').src = `data:image/png;base64,${data.qr_code_base64}`;
            document.getElementById('pixCopiaCola').value = data.qr_code;
            document.getElementById('modalValor').classList.add('hidden');
            document.getElementById('modalPix').classList.remove('hidden');
        }
    }

    async function comprarCartelas() {
        await fetch(`${API}/comprar-com-saldo`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ usuarioId: USER_ID, quantidade: 1 }) });
        atualizarInterface();
    }

    function logout() { localStorage.clear(); location.reload(); }
    function abrirModalValor() { document.getElementById('modalValor').classList.remove('hidden'); }

    setInterval(() => {
        if (segundosRestantes > 0) {
            segundosRestantes--;
            const min = Math.floor(segundosRestantes / 60);
            const seg = segundosRestantes % 60;
            document.getElementById('timerTxt').innerText = `${min.toString().padStart(2,'0')}:${seg.toString().padStart(2,'0')}`;
        }
    }, 1000);

    if(USER_ID) {
        document.getElementById('telaAuth').classList.add('hidden');
        document.getElementById('telaJogo').classList.remove('hidden');
        iniciarGrade();
        atualizarInterface();
        setInterval(atualizarInterface, 3000);
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Live - R$ 1.000,00</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #020617; color: #e2e8f0; padding: 10px; margin: 0; padding-bottom: 60px; }
        .box { background: #1e293b; border-radius: 12px; padding: 15px; border: 1px solid #334155; margin-bottom: 15px; text-align: center; }
        .valor-destaque { color: #facc15; font-weight: bold; font-size: 1.2rem; }
        .premio-box { background: linear-gradient(90deg, #b45309, #f59e0b, #b45309); color: #fff; text-align: center; padding: 15px; border-radius: 12px; border: 1px solid #facc15; margin-bottom: 15px; }
        
        /* Login */
        #telaLogin { position: fixed; top:0; left:0; width:100%; height:100%; background:#020617; z-index:1000; display:flex; align-items:center; justify-content:center; }
        .login-card { background:#1e293b; padding:25px; border-radius:15px; width:90%; max-width:320px; text-align:center; border: 1px solid #334155; }
        input { width: 90%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: #fff; text-align: center; }
        
        /* Botões */
        .btn { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; }
        .btn-green { background: #22c55e; color: white; }
        .btn-blue { background: #3b82f6; color: white; }
        
        /* Jogo */
        .bola { display: inline-flex; width: 35px; height: 35px; align-items: center; justify-content: center; font-weight: bold; margin: 3px; border-radius: 50%; background: #334155; border: 1px solid #facc15; color: white; }
        .sorteada { background: #22c55e; box-shadow: 0 0 10px #22c55e; }
        #statusServer { font-size: 0.7rem; margin-bottom: 10px; color: #4ade80; }
    </style>
</head>
<body>

<div id="telaLogin">
    <div class="login-card">
        <h2 style="color:#facc15; margin-top:0;">BINGO LIVE</h2>
        <div id="statusServer">● Servidor Conectado</div>
        
        <div id="areaLogin">
            <input type="email" id="email" placeholder="Seu E-mail">
            <input type="password" id="senha" placeholder="Sua Senha">
            <button class="btn btn-green" onclick="autenticar('login')">Entrar</button>
            <p style="font-size: 0.8rem;">Novo? <a href="#" onclick="toggleForm(true)" style="color:#3b82f6;">Criar Conta</a></p>
        </div>

        <div id="areaCadastro" style="display:none;">
            <input type="text" id="nomeReg" placeholder="Nome Completo">
            <input type="email" id="emailReg" placeholder="E-mail">
            <input type="password" id="senhaReg" placeholder="Senha">
            <button class="btn btn-blue" onclick="autenticar('cadastro')">Cadastrar</button>
            <p style="font-size: 0.8rem;">Já tem conta? <a href="#" onclick="toggleForm(false)" style="color:#3b82f6;">Login</a></p>
        </div>
    </div>
</div>

<div class="premio-box">
    <small>PRÊMIO DA RODADA</small><br>
    <b style="font-size:1.8rem;">R$ 1.000,00</b>
</div>

<div class="box">
    <div style="display:flex; justify-content: space-between; align-items:center;">
        <div style="text-align:left;">
            <small style="color:#94a3b8;">OLÁ, <span id="nomeUser">...</span></small><br>
            <span class="valor-destaque" id="saldoUser">R$ 0,00</span>
        </div>
        <button style="background:#32bcad; border:none; padding:5px 10px; border-radius:5px; font-weight:bold;">PIX</button>
    </div>
</div>

<div class="box">
    <h3 id="txtStatus">Aguardando Início...</h3>
    <div id="timer" style="font-size: 2rem; font-weight: bold; color: #22c55e;">00:00</div>
    <div id="containerBolas" style="margin-top:15px;"></div>
</div>

<script>
    const API = "https://bingo-backend-89dt.onrender.com"; //
    let usuarioAtivo = null;

    function toggleForm(isReg) {
        document.getElementById('areaLogin').style.display = isReg ? 'none' : 'block';
        document.getElementById('areaCadastro').style.display = isReg ? 'block' : 'none';
    }

    async function autenticar(tipo) {
        const isLogin = tipo === 'login';
        const payload = isLogin ? 
            { email: id('email').value, senha: id('senha').value } :
            { name: id('nomeReg').value, email: id('emailReg').value, senha: id('senhaReg').value };

        try {
            const res = await fetch(`${API}/${isLogin ? 'login' : 'register'}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });
            const data = await res.json();
            if(res.ok) {
                if(isLogin) {
                    usuarioAtivo = data.user;
                    id('nomeUser').innerText = usuarioAtivo.name.toUpperCase();
                    id('saldoUser').innerText = `R$ ${usuarioAtivo.saldo.toFixed(2)}`;
                    id('telaLogin').style.display = 'none';
                    iniciarMonitoramento();
                } else {
                    alert("Cadastro realizado! Faça login.");
                    toggleForm(false);
                }
            } else { alert(data.message); }
        } catch (e) { alert("Servidor acordando... tente novamente."); }
    }

    async function atualizarStatusJogo() {
        try {
            const res = await fetch(`${API}/game-status`);
            const status = await res.json();
            
            id('timer').innerText = status.tempo || "00:00";
            id('txtStatus').innerText = status.fase === 'sorteio' ? "SORTEANDO BOLAS!" : "PRÓXIMA RODADA EM:";
            
            if(status.bolas) {
                id('containerBolas').innerHTML = status.bolas.map(b => `<div class="bola sorteada">${b}</div>`).join('');
            }
        } catch (e) { console.log("Sincronizando..."); }
    }

    function iniciarMonitoramento() {
        setInterval(atualizarStatusJogo, 3000);
    }

    function id(el) { return document.getElementById(el); }
</script>

</body>
</html>

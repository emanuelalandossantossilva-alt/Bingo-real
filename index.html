<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bingo Real - Oficial</title>
    <style>
        :root { 
            --primary: #facc15; 
            --primary-dark: #ca8a04;
            --bg: #020617; 
            --card: rgba(30, 41, 59, 0.7); 
            --success: #22c55e; 
            --glass: rgba(255, 255, 255, 0.05);
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        html, body { 
            height: 100%; margin: 0; padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at top, #1e293b 0%, #020617 100%);
            color: white; overflow: hidden; position: fixed; width: 100%;
        }

        .hidden { display: none !important; }

        /* --- LOGIN PROFISSIONAL --- */
        .auth-container { 
            height: 100vh; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px;
            background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
        }

        .logo-main {
            font-size: 42px; font-weight: 900; color: var(--primary);
            text-shadow: 0 0 20px rgba(250, 204, 21, 0.4); margin: 0;
        }

        .auth-card { 
            background: var(--card); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding: 30px; border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.1); 
            width: 100%; max-width: 360px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        input { 
            width: 100%; padding: 14px 18px; border-radius: 12px; 
            border: 1px solid rgba(255, 255, 255, 0.1); background: rgba(0, 0, 0, 0.2); 
            color: white; font-size: 16px; margin-bottom: 15px;
        }

        .btn-primary { 
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: #451a03; width: 100%; padding: 16px; border: none; 
            border-radius: 12px; font-weight: 800; text-transform: uppercase;
            cursor: pointer; box-shadow: 0 10px 15px -3px rgba(250, 204, 21, 0.3);
        }

        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }

        /* --- DESIGN DO JOGO --- */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 0 15px; background: #0f172a; border-bottom: 2px solid var(--primary); height: 60px; }
        .status-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; background: #1e293b; padding: 10px 5px; border-bottom: 1px solid #334155; }
        .status-item { text-align: center; }
        .status-label { font-size: 9px; color: #94a3b8; text-transform: uppercase; }
        .status-val { font-size: 14px; font-weight: bold; display: block; }
        
        .card-bingo { background: #1e293b; padding: 15px; border-radius: 15px; border: 1px solid var(--primary); margin: 10px; }
        .bola-master { width: 80px; height: 80px; background: radial-gradient(circle at 30% 30%, #fff, #facc15 60%, #b45309); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; font-weight: 900; color: #000; margin: 0 auto 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        
        .painel-numeros { display: grid; grid-template-columns: repeat(10, 1fr); gap: 3px; background: #020617; padding: 5px; border-radius: 8px; }
        .num-check { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 10px; background: #1e293b; color: #475569; border-radius: 4px; }
        .num-check.ativo { background: var(--success); color: white; box-shadow: 0 0 10px var(--success); }
    </style>
</head>
<body>

<audio id="audioBola" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>

<div id="telaAuth" class="auth-container">
    <h1 class="logo-main">BINGO REAL</h1>
    <p style="color: #94a3b8; margin-top: -5px; letter-spacing: 2px; font-size: 12px; margin-bottom: 25px;">PREMIANDO A SUA SORTE</p>
    <div class="auth-card">
        <input type="email" id="emailLogin" placeholder="E-mail">
        <input type="password" id="senhaLogin" placeholder="Senha">
        <button id="btnLogin" class="btn-primary" onclick="fazerLogin()">Entrar na Conta</button>
        <button style="background:none; border:none; color:#94a3b8; width:100%; margin-top:15px; cursor:pointer" onclick="document.getElementById('modalReg').classList.remove('hidden')">Criar Conta Grátis</button>
    </div>
</div>

<div id="modalReg" class="modal hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.8); display:flex; align-items:center; justify-content:center; z-index:100">
    <div class="auth-card" style="background:#1e293b">
        <h2 style="text-align:center; color:var(--primary)">CADASTRO</h2>
        <input type="text" id="regNome" placeholder="Nome">
        <input type="email" id="regEmail" placeholder="E-mail">
        <input type="password" id="regSenha" placeholder="Senha">
        <button class="btn-primary" onclick="fazerCadastro()">Cadastrar Agora</button>
        <button style="background:none; border:none; color:#94a3b8; width:100%; margin-top:15px;" onclick="document.getElementById('modalReg').classList.add('hidden')">Voltar</button>
    </div>
</div>

<div id="telaJogo" class="hidden">
    <div class="header">
        <div style="font-weight:900; color:var(--primary); font-size:18px;">BINGO REAL</div>
        <button onclick="logout()" style="background:#ef4444; color:white; border:none; padding:5px 10px; border-radius:5px">Sair</button>
    </div>
    <div class="status-bar">
        <div class="status-item"><span class="status-label">Tempo</span><span id="timerTxt" class="status-val">00:00</span></div>
        <div class="status-item"><span class="status-label">Saldo</span><span id="playerSaldoStatus" class="status-val" style="color:var(--success)">R$ 0,00</span></div>
        <div class="status-item"><span class="status-label">ID</span><span id="userIdDisplay" class="status-val">...</span></div>
    </div>
    <div class="card-bingo">
        <div id="bolaGrande" class="bola-master">--</div>
        <div class="painel-numeros" id="gradeNumeros"></div>
    </div>
    <div style="padding:15px"><button onclick="comprarCartelas()" class="btn-primary" style="background:#2563eb; color:white">Comprar Cartela (R$ 1,00)</button></div>
    <div id="listaCartelas" style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center; padding:10px; overflow-y:auto; height:200px"></div>
</div>

<script>
    const API = "https://bingo-backend-89dt.onrender.com";
    let USER_ID = localStorage.getItem('userId');
    let ultimaBola = null;

    function tocarSom() { document.getElementById('audioBola').play().catch(() => {}); }

    async function fazerLogin() {
        const email = document.getElementById('emailLogin').value;
        const senha = document.getElementById('senhaLogin').value;
        const btn = document.getElementById('btnLogin');
        
        btn.innerText = "CONECTANDO...";
        btn.disabled = true;

        try {
            const res = await fetch(`${API}/login`, { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({ email, senha }) 
            });
            const data = await res.json();
            if(res.ok) { 
                localStorage.setItem('userId', data._id); 
                location.reload(); 
            } else { 
                alert("Dados incorretos."); 
                btn.innerText = "ENTRAR NA CONTA"; btn.disabled = false;
            }
        } catch(e) { 
            alert("O servidor está acordando... Tente novamente em 15 segundos."); 
            btn.innerText = "ENTRAR NA CONTA"; btn.disabled = false;
        }
    }

    async function fazerCadastro() {
        const name = document.getElementById('regNome').value;
        const email = document.getElementById('regEmail').value;
        const senha = document.getElementById('regSenha').value;
        await fetch(`${API}/register`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ name, email, senha }) });
        alert("Cadastro feito! Faça login.");
        location.reload();
    }

    async function atualizar() {
        if(!USER_ID) return;
        try {
            const [resJ, resU] = await Promise.all([fetch(`${API}/game-status`), fetch(`${API}/user-data/${USER_ID}`)]);
            const jogo = await resJ.json();
            const user = await resU.json();

            document.getElementById('playerSaldoStatus').innerText = `R$ ${user.saldo.toFixed(2)}`;
            document.getElementById('userIdDisplay').innerText = USER_ID.substring(0,6);
            
            const bolas = jogo.bolas || [];
            if(bolas.length > 0) {
                const nova = bolas[bolas.length - 1];
                if(nova !== ultimaBola) { document.getElementById('bolaGrande').innerText = nova; tocarSom(); ultimaBola = nova; }
            }

            document.querySelectorAll('.num-check').forEach(el => el.classList.remove('ativo'));
            bolas.forEach(b => document.getElementById(`num-${b}`)?.classList.add('ativo'));
        } catch(e) {}
    }

    function logout() { localStorage.clear(); location.reload(); }

    if(USER_ID) {
        document.getElementById('telaAuth').classList.add('hidden');
        document.getElementById('telaJogo').classList.remove('hidden');
        const grade = document.getElementById('gradeNumeros');
        for(let i=1; i<=50; i++) grade.innerHTML += `<div class="num-check" id="num-${i}">${i}</div>`;
        setInterval(atualizar, 3000);
    }
</script>
</body>
</html>

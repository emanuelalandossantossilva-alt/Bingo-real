<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Real - Cartelas e Timer</title>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #1a1a1a; color: white; text-align: center; margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: #2a2a2a; padding: 20px; border-radius: 15px; border: 2px solid #edb120; }
        
        /* Banner Acumulado */
        .acumulado-container { 
            background: linear-gradient(145deg, #edb120, #b8860b); 
            color: #000; padding: 20px; border-radius: 10px; 
            margin-bottom: 20px; font-weight: bold; border: 2px solid #fff; 
            box-shadow: 0 0 20px #edb120; 
        }
        .status-texto { font-size: 26px; letter-spacing: 2px; animation: flash 1.5s infinite; }
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* Cronómetro */
        .timer-box { font-size: 18px; color: #ff4444; margin: 10px 0; font-weight: bold; }
        #countdown { font-size: 35px; color: #fff; margin-bottom: 20px; }

        /* Cartela Gerada */
        .cartela-area { display: none; margin: 20px 0; background: #fff; color: #000; padding: 15px; border-radius: 10px; border: 3px solid #edb120; }
        .grid-cartela { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-top: 10px; }
        .num-cartela { background: #f0f0f0; padding: 10px; border-radius: 5px; font-weight: bold; font-size: 18px; border: 1px solid #ddd; }

        .saldo-box { font-size: 22px; margin-bottom: 15px; color: #28a745; font-weight: bold; }
        .btn-comprar { background-color: #edb120; color: #000; border: none; padding: 15px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; font-size: 20px; transition: 0.2s; }
        .btn-comprar:active { transform: scale(0.98); }

        input { width: 60%; padding: 10px; margin: 15px 0; border-radius: 5px; border: none; text-align: center; }
        .btn-pix { background-color: #28a745; color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <div class="container">
        <div class="acumulado-container">
            <span class="status-texto">ACUMULANDO...</span>
        </div>

        <div class="saldo-box">Saldo: R$ <span id="saldo">0,00</span></div>

        <div class="timer-box">PRÓXIMO SORTEIO EM:</div>
        <div id="countdown">05:00</div>

        <button class="btn-comprar" id="btn-comprar" onclick="comprarCartela()">COMPRAR CARTELA (R$ 2,00)</button>

        <div id="cartela-area" class="cartela-area">
            <strong>SUA CARTELA (ID: #<span id="cartela-id"></span>)</strong>
            <div id="grid-cartela" class="grid-cartela"></div>
            <p style="font-size: 11px; margin-top: 10px; color: #d9534f;">* 10 números entre 01 e 50</p>
        </div>

        <div style="margin-top: 25px; border-top: 1px solid #444; padding-top: 15px;">
            <input type="number" id="valor-input" value="10" min="10">
            <button class="btn-pix" onclick="gerarPix()">Depositar via PIX (Mín. 10)</button>
        </div>
    </div>

    <script>
        let saldo = 0.00;
        let acumuladoOculto = 0.00;
        let tempoRestante = 300; // 5 minutos em segundos

        // Regras de Geração da Cartela (50 números, sem dobrados, sem sequências de 3)
        function gerarCartelaValida() {
            let numeros = [];
            while (numeros.length < 10) {
                let n = Math.floor(Math.random() * 50) + 1;
                
                if (numeros.includes(n)) continue; // Não repete
                if ([11, 22, 33, 44].includes(n)) continue; // Não dobrados
                
                // Evita sequências de 3 (ex: 10, 11, 12)
                let sequencia = false;
                if (numeros.includes(n-1) && numeros.includes(n-2)) sequencia = true;
                if (numeros.includes(n+1) && numeros.includes(n+2)) sequencia = true;
                if (numeros.includes(n-1) && numeros.includes(n+1)) sequencia = true;
                
                if (sequencia) continue;
                
                numeros.push(n);
            }
            return numeros.sort((a, b) => a - b);
        }

        function comprarCartela() {
            if (saldo >= 2.00) {
                saldo -= 2.00;
                acumuladoOculto += 1.80;
                document.getElementById('saldo').innerText = saldo.toFixed(2).replace('.', ',');

                const cartela = gerarCartelaValida();
                const grid = document.getElementById('grid-cartela');
                grid.innerHTML = "";
                cartela.forEach(n => {
                    grid.innerHTML += `<div class="num-cartela">${n < 10 ? '0'+n : n}</div>`;
                });

                document.getElementById('cartela-area').style.display = 'block';
                document.getElementById('cartela-id').innerText = Math.floor(Math.random() * 9999);
                alert("Boa sorte! Cartela gerada.");
            } else {
                alert("Saldo insuficiente!");
            }
        }

        // Lógica do Timer de 5 Minutos
        function atualizarTimer() {
            const min = Math.floor(tempoRestante / 60);
            const seg = tempoRestante % 60;
            document.getElementById('countdown').innerText = 
                `${min.toString().padStart(2, '0')}:${seg.toString().padStart(2, '0')}`;
            
            if (tempoRestante <= 0) {
                document.getElementById('countdown').innerText = "SORTEANDO!";
                document.getElementById('btn-comprar').disabled = true;
                
                setTimeout(() => {
                    tempoRestante = 300; // Reinicia 5 min
                    document.getElementById('btn-comprar').disabled = false;
                }, 10000); // 10 segundos de pausa para o sorteio
            } else {
                tempoRestante--;
            }
        }
        setInterval(atualizarTimer, 1000);

        async function gerarPix() {
            const v = document.getElementById('valor-input').value;
            if (v < 10) return alert("Mínimo R$ 10");
            try {
                const res = await fetch('https://bingo-backend-89dt.onrender.com/gerar-pix', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ valor: v })
                });
                const data = await res.json();
                if (data.qr_code) alert("PIX Gerado com sucesso!");
            } catch (e) { alert("Servidor a iniciar..."); }
        }
    </script>
</body>
</html>

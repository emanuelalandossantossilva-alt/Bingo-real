<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Real - Oficial</title>
    <style>
        body { font-family: sans-serif; background: #020617; color: white; text-align: center; margin: 0; padding: 10px; }
        .card { background: #1e293b; padding: 15px; border-radius: 12px; border: 1px solid #facc15; margin: 10px auto; max-width: 380px; box-sizing: border-box; }
        .hidden { display: none !important; }
        
        /* Inputs e Botões */
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 14px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin: 5px 0; text-transform: uppercase; }
        
        /* Ranking */
        .item-ranking { background: #0f172a; padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #facc15; display: flex; justify-content: space-between; align-items: center; }
        .posicao { color: #facc15; font-weight: bold; margin-right: 10px; }
        .nome-user { flex-grow: 1; text-align: left; font-size: 14px; }
        .pontos { background: #22c55e; padding: 4px 8px; border-radius: 5px; font-size: 12px; }

        /* Jogo */
        .caixa-premio { background: #064e3b; border: 2px solid #22c55e; padding: 10px; border-radius: 10px; margin-bottom: 15px; }
        .valor-acumulado { font-size: 26px; color: #4ade80; font-weight: bold; }
        .abas { display: flex; background: #0f172a; border-radius: 8px; padding: 4px; margin-bottom: 10px; }
        .aba { cursor: pointer; padding: 8px; color: #94a3b8; flex: 1; font-size: 12px; font-weight: bold; border-radius: 6px; }
        .aba.ativa { color: #020617; background: #facc15; }
        .bola-sorteada { width: 22px; height: 22px; background: #facc15; color: black; border-radius: 50%; font-size: 11px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    </style>
</head>
<body>

<div id="telaLogin" class="card">
    <h2 style="color:#facc15;">BINGO REAL</h2>
    <input type="email" id="loginEmail" placeholder="Seu E-mail">
    <input type="password" id="loginSenha" placeholder="Sua Senha">
    <button style="background: #2563eb; color: white;" onclick="fazerLogin()">ENTRAR NO JOGO</button>
    <p onclick="mostrarCadastro()" style="cursor:pointer; color:#facc15; font-size:14px; margin-top:10px;">Não tem conta? Cadastre-se</p>
</div>

<div id="telaCadastro" class="card hidden">
    <h2 style="color:#facc15;">CADASTRO</h2>
    <input type="text" id="cadNome" placeholder="Seu Nome Completo">
    <input type="email" id="cadEmail" placeholder="Seu Melhor E-mail">
    <input type="password" id="cadSenha" placeholder="Crie uma Senha">
    <button style="background: #16a34a; color: white;" onclick="fazerCadastro()">CRIAR MINHA CONTA</button>
    <p onclick="mostrarLogin()" style="cursor:pointer; color:#facc15; font-size:14px; margin-top:10px;">Já tenho conta (Login)</p>
</div>

<div id="telaJogo" class="hidden">
    <div class="card">
        <div class="caixa-premio">
            <div id="suspenseTxt" style="color:#facc15; font-size:14px;">PRÊMIO ACUMULANDO...</div>
            <div id="valorRevelado" class="hidden">
                <small style="color:#4ade80;">VALOR EM JOGO</small>
                <div id="valorPremio" class="valor-acumulado">R$ 0,00</div>
            </div>
        </div>

        <div class="abas">
            <div id="tabSorteio" class="aba ativa" onclick="mudarAba('sorteio')">SORTEIO</div>
            <div id="tabRanking" class="aba" onclick="mudarAba('ranking')">TOP 10 ACERTOS</div>
        </div>

        <div id="conteudoSorteio">
            <div id="timerTxt" style="font-size: 24px; color: #facc15; font-weight: bold; margin-bottom: 10px;">05:00</div>
            <div id="bolaGrande" style="font-size: 60px; color: #fff; font-weight: bold; margin: 10px 0;">--</div>
            <div id="historicoBolas" style="display:flex; flex-wrap:wrap; justify-content:center; gap:5px;"></div>
        </div>

        <div id="conteudoRanking" class="hidden">
            <div id="listaRanking">
                <p style="color:#94a3b8; font-size:12px;">As cartelas aparecerão aqui quando o sorteio começar.</p>
            </div>
        </div>

        <div style="margin: 15px 0; font-weight:bold; font-size:18px;">
            <span id="playerSaldo" style="color:#22c55e;">Saldo: R$ 0,00</span>
        </div>

        <div style="background:#0f172a; padding:10px; border-radius:10px; margin-bottom:10px;">
            <label style="font-size:11px;">QUANTIDADE:</label>
            <input type="number" id="qtdCartelas" value="1" min="1" style="width:50px; text-align:center; padding:5px; margin:0 10px;">
            <button id="btnComprar" style="background: #2563eb; color: white; width:60%;" onclick="comprarCartelas()">COMPRAR</button>
        </div>

        <button style="background: #16a34a; color: white;" onclick="abrirPix()">DEPOSITAR SALDO</button>
    </div>
</div>

<script>
    const API = "https://bingo-backend-89dt.onrender.com";
    let USER_ID = localStorage.getItem('userId');

    function mostrarLogin() { document.getElementById('telaLogin').classList.remove('hidden'); document.getElementById('telaCadastro').classList.add('hidden'); }
    function mostrarCadastro() { document.getElementById('telaLogin').classList.add('hidden'); document.getElementById('telaCadastro').classList.remove('hidden'); }

    async function atualizarInterface() {
        if(!USER_ID) return;
        try {
            const res = await fetch(`${API}/game-status`);
            const jogo = await res.json();
            
            document.getElementById('timerTxt').innerText = jogo.tempoRestante;

            // Mostrar Valor e Bolas
            if (jogo.bolas && jogo.bolas.length > 0) {
                document.getElementById('suspenseTxt').classList.add('hidden');
                document.getElementById('valorRevelado').classList.remove('hidden');
                document.getElementById('valorPremio').innerText = `R$ ${jogo.premioAcumulado.toFixed(2)}`;
                document.getElementById('bolaGrande').innerText = jogo.bolas[jogo.bolas.length - 1];
                document.getElementById('btnComprar').disabled = true;
                document.getElementById('btnComprar').innerText = "EM JOGO";
                document.getElementById('historicoBolas').innerHTML = jogo.bolas.map(b => `<div class="bola-sorteada">${b}</div>`).join('');
                
                // Atualizar Ranking Top 10
                if (jogo.todasCartelas) {
                    const top10 = jogo.todasCartelas.sort((a,b) => b.acertos - a.acertos).slice(0, 10);
                    document.getElementById('listaRanking').innerHTML = top10.map((c, i) => `
                        <div class="item-ranking">
                            <span class="posicao">#${i+1}</span>
                            <span class="nome-user">${c.nomeJogador}</span>
                            <span class="pontos">${c.acertos} ACERTOS</span>
                        </div>`).join('');
                }
            } else {
                document.getElementById('suspenseTxt').classList.remove('hidden');
                document.getElementById('valorRevelado').classList.add('hidden');
                document.getElementById('btnComprar').disabled = false;
                document.getElementById('btnComprar').innerText = "COMPRAR";
                document.getElementById('bolaGrande').innerText = "--";
                document.getElementById('historicoBolas').innerHTML = "";
            }

            // Saldo do usuário
            const resUser = await fetch(`${API}/user-data/${USER_ID}`);
            const user = await resUser.json();
            document.getElementById('playerSaldo').innerText = `Saldo: R$ ${user.saldo.toFixed(2)}`;
        } catch (e) {}
    }

    async function fazerLogin() {
        const res = await fetch(`${API}/login`, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ email: loginEmail.value, senha: loginSenha.value })
        });
        if(res.ok) {
            const d = await res.json();
            localStorage.setItem('userId', d.user._id);
            location.reload();
        } else alert("Dados incorretos!");
    }

    async function fazerCadastro() {
        const res = await fetch(`${API}/register`, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ name: cadNome.value, email: cadEmail.value, senha: cadSenha.value })
        });
        if(res.ok) { alert("Sucesso! Faça o login."); mostrarLogin(); }
    }

    async function comprarCartelas() {
        const qtd = document.getElementById('qtdCartelas').value;
        await fetch(`${API}/comprar-com-saldo-multiplo`, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ usuarioId: USER_ID, quantidade: qtd })
        });
        atualizarInterface();
    }

    function mudarAba(aba) {
        document.getElementById('conteudoSorteio').classList.toggle('hidden', aba !== 'sorteio');
        document.getElementById('conteudoRanking').classList.toggle('hidden', aba !== 'ranking');
        document.getElementById('tabSorteio').classList.toggle('ativa', aba === 'sorteio');
        document.getElementById('tabRanking').classList.toggle('ativa', aba === 'ranking');
    }

    if(USER_ID) {
        document.getElementById('telaLogin').classList.add('hidden');
        document.getElementById('telaJogo').classList.remove('hidden');
        setInterval(atualizarInterface, 3000);
    }
</script>
</body>
</html>
